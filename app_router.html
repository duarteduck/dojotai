<script>
/**
 * Router simples por hash:
 * - #/login
 * - #/dash
 * - #/new
 * - #/edit?id={ID}
 * - #/members (NOVO)
 * - #/member?id={ID} (NOVO)
 */
var Router = {
  start: function(){
    try { window.addEventListener('hashchange', this.resolve.bind(this)); } catch(e){}
    this.resolve();
  },
  
  mount: function(view){
    var root = document.getElementById('app');
    if (!root) return;

    var tplId = 'tpl-login';
    if (view === 'dash') tplId = 'tpl-dash';
    if (view === 'new')  tplId = 'tpl-new';
    if (view === 'members') tplId = 'tpl-members';        // NOVO
    if (view === 'member')  tplId = 'tpl-member-profile'; // NOVO (futuro)

    var tpl = document.getElementById('tpl-'+view) || document.getElementById(tplId);
    if (tpl){
      root.innerHTML = tpl.innerHTML;
      
      var init = null;
      if (view === 'login')  init = Views.initLogin;
      if (view === 'dash')   init = Views.initDash;
      if (view === 'new')    init = Views.initNew;
      if (view === 'members') init = Views.initMembers;    // NOVO
      if (view === 'member')  init = Views.initMemberProfile; // NOVO (futuro)
      
      if (typeof init === 'function') init();
    }
  },

  resolve: function(){
    var route = (location.hash || '#/login');
    var authed = !!(window.localStorage && localStorage.getItem('uid'));

    // Proteção de rotas autenticadas
    if (route.indexOf('#/dash') === 0 && !authed) { return this.go('#/login'); }
    if (route.indexOf('#/new')  === 0 && !authed) { return this.go('#/login'); }
    if (route.indexOf('#/edit') === 0 && !authed) { return this.go('#/login'); }
    if (route.indexOf('#/members') === 0 && !authed) { return this.go('#/login'); } // NOVO
    if (route.indexOf('#/member')  === 0 && !authed) { return this.go('#/login'); } // NOVO
    
    // Redirecionamento se já logado
    if (route.indexOf('#/login')=== 0 && authed)  { return this.go('#/dash'); }

    // Determinação da view
    var view = 'login';
    if (route.indexOf('#/dash') === 0) view = 'dash';
    if (route.indexOf('#/new')  === 0) view = 'new';
    if (route.indexOf('#/edit') === 0) view = 'new';        // edit usa o mesmo template de new
    if (route.indexOf('#/members') === 0) view = 'members'; // NOVO
    if (route.indexOf('#/member')  === 0) view = 'member';  // NOVO

    this.mount(view);
  },

  go: function(hash){ location.hash = hash; }
};
</script>