<script>
    // ============================================================================
    // DATE HELPERS
    // Funções utilitárias para formatação e manipulação de datas
    // ============================================================================

    /**
     * Formata uma data para o padrão brasileiro com hora
     * @param {string|Date} dateString - Data a ser formatada
     * @returns {string} - Data formatada como "DD/MM/YYYY - HH:MM"
     */
    function formatDate(dateString) {
        // Data já vem no fuso horário correto do Brasil
        const date = new Date(dateString);
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');

        return `${day}/${month}/${year} - ${hours}:${minutes}`;
    }

    /**
     * Retorna status inteligente baseado na data e status atual
     * @param {string} status - Status atual da atividade
     * @param {string} dateString - Data da atividade
     * @returns {Object} - {text: string, class: string}
     */
    function getSmartStatus(status, dateString) {
        // Data atual no Brasil (assumindo que o servidor já está configurado para UTC-3)
        const today = new Date();
        today.setHours(0, 0, 0, 0); // Zerar horas para comparação apenas da data

        // Data da atividade (assumindo que já vem no fuso correto do Brasil)
        const activityDate = new Date(dateString);
        activityDate.setHours(0, 0, 0, 0); // Zerar horas para comparação apenas da data

        const timeDiff = activityDate.getTime() - today.getTime();
        const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));

        // Se já foi concluída/realizada - verde
        if (status && (status.toLowerCase() === 'realizada' || status.toLowerCase() === 'concluida')) {
            return {
                text: 'Concluída',
                class: 'badge-success'
            };
        }

        // Se foi cancelada - vermelho
        if (status && status.toLowerCase() === 'cancelada') {
            return {
                text: 'Cancelada',
                class: 'badge-cancelada'
            };
        }

        // Se status é pendente, verificar datas
        if (status && status.toLowerCase() === 'pendente') {
            if (daysDiff < 0) {
                // Data passou - ATRASADO com cor vermelha (danger)
                return {
                    text: 'Atrasado',
                    class: 'badge-danger'
                };
            } else if (daysDiff === 0) {
                // É hoje - HOJE com cor de pendente (amarelo)
                return {
                    text: 'Hoje',
                    class: 'badge-warning'
                };
            } else {
                // Data futura - PENDENTE com cor pendente (amarelo)
                return {
                    text: 'Pendente',
                    class: 'badge-warning'
                };
            }
        }

        // Fallback para outros status
        return {
            text: status || 'Indefinido',
            class: 'badge-secondary'
        };
    }

    /**
     * Verifica se uma atividade já passou (a partir do dia da atividade)
     * @param {string|Date} dateString - Data da atividade
     * @returns {boolean} - true se já passou, false caso contrário
     */
    function isActivityPast(dateString) {
        const hoje = new Date();
        hoje.setHours(0, 0, 0, 0); // Zera hora para comparar apenas datas

        const dataAtividade = new Date(dateString);
        dataAtividade.setHours(0, 0, 0, 0);

        return dataAtividade < hoje;
    }

    // Expor funções globalmente
    window.formatDate = formatDate;
    window.getSmartStatus = getSmartStatus;
    window.isActivityPast = isActivityPast;
</script>
