<!-- Sistema de Estado da AplicaÃ§Ã£o -->
<script>
    // ============================================================================
    // CACHE GLOBAL: Categorias e ResponsÃ¡veis
    // Carregados UMA ÃšNICA VEZ no DOMContentLoaded e reutilizados em toda a app
    // ============================================================================
    // NOTA: Quando implementar cadastro de categorias/usuÃ¡rios, invalidar cache:
    //       window.cachedCategorias = null; carregarCategorias();
    //       window.cachedResponsaveis = null; carregarResponsaveis();
    // ============================================================================
    window.cachedCategorias = null;
    window.cachedResponsaveis = null;

    window.State = {
      get uid(){ return localStorage.getItem('uid'); },
      set uid(v){ localStorage.setItem('uid', v); },

      get user(){
        const userData = localStorage.getItem('user');
        return userData ? JSON.parse(userData) : null;
      },
      set user(v){
        if(v) {
          localStorage.setItem('user', JSON.stringify(v));
        } else {
          localStorage.removeItem('user');
        }
      },

      get session(){
        const sessionData = localStorage.getItem('session');
        return sessionData ? JSON.parse(sessionData) : null;
      },
      set session(v){
        if(v) {
          localStorage.setItem('session', JSON.stringify(v));
          console.log('ðŸ’¾ State.session salva:', v.id);
        } else {
          localStorage.removeItem('session');
        }
      },

      get selectedMember(){
        const memberData = localStorage.getItem('selectedMember');
        return memberData ? JSON.parse(memberData) : null;
      },
      set selectedMember(v){
        if(v) {
          localStorage.setItem('selectedMember', JSON.stringify(v));
          console.log('ðŸ’¾ State.selectedMember salvo:', v.membro_nome);
        } else {
          localStorage.removeItem('selectedMember');
        }
      },

      get selectedMemberId(){
        return localStorage.getItem('selectedMemberId');
      },
      set selectedMemberId(v){
        if(v) {
          localStorage.setItem('selectedMemberId', v);
        } else {
          localStorage.removeItem('selectedMemberId');
        }
      },

      clear(){
        localStorage.removeItem('uid');
        localStorage.removeItem('user');
        localStorage.removeItem('session');
        localStorage.removeItem('selectedMember');
        localStorage.removeItem('selectedMemberId');
        console.log('ðŸ§¹ State limpo - uid, user, session, selectedMember removidos');
      },

      cache: { atividades: [] },
      ui: { minhas:false, nomeFiltro:"" }
    };
</script>
