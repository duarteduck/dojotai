<script>
/**
 * Router simples por hash:
 * - #/login
 * - #/dashboard
 * - #/atividades
 * - #/new
 * - #/edit?id={ID}
 * - #/members
 * - #/member?id={ID}
 * - #/practices
 * - #/reports
 */
var Router = {
  start: function(){
    try { window.addEventListener('hashchange', this.resolve.bind(this)); } catch(e){}
    this.resolve();
  },
  
  mount: function(view){
    var root = document.getElementById('app');
    if (!root) return;

    console.log('üîÑ Router.mount chamado para view:', view);

    var tplId = 'tpl-' + view;
    var tpl = document.getElementById(tplId);
    
    if (tpl){
      root.innerHTML = tpl.innerHTML;
      
      var init = null;
      if (view === 'login')  init = Views.initLogin;
      if (view === 'dashboard') init = Views.initDashboard;
      if (view === 'atividades') init = Views.initAtividades;
      if (view === 'new')    init = Views.initNew;
      if (view === 'members') init = Views.initMembers;
      if (view === 'member') init = Views.initMember;
      if (view === 'practices') init = Views.initPractices;
      if (view === 'reports') init = Views.initReports;
      
      console.log('üéØ Inicializador encontrado para', view, ':', typeof init);
      
      if (typeof init === 'function') {
        init();
      } else {
        console.error('‚ùå Inicializador n√£o encontrado para view:', view);
      }
    } else {
      console.error('‚ùå Template n√£o encontrado:', tplId);
    }
  },

  resolve: function(){
    var route = (location.hash || '#/login');
    var authed = !!(window.localStorage && localStorage.getItem('uid'));

    console.log('üó∫Ô∏è Router.resolve - Rota:', route, 'Autenticado:', authed);
    console.log('üîç DEBUG: location.hash =', location.hash);

    // Prote√ß√£o de rotas autenticadas (ordem importa - mais espec√≠fico primeiro)
    if (route.indexOf('#/dashboard') === 0 && !authed) { return this.go('#/login'); }
    else if (route.indexOf('#/atividades') === 0 && !authed) { return this.go('#/login'); }
    if (route.indexOf('#/new')  === 0 && !authed) { return this.go('#/login'); }
    if (route.indexOf('#/edit') === 0 && !authed) { return this.go('#/login'); }
    if (route.indexOf('#/members') === 0 && !authed) { return this.go('#/login'); }
    if (route.indexOf('#/member') === 0 && !authed) { return this.go('#/login'); }
    if (route.indexOf('#/practices') === 0 && !authed) { return this.go('#/login'); }
    if (route.indexOf('#/reports') === 0 && !authed) { return this.go('#/login'); }

    // Redirecionamento se j√° logado
    if (route.indexOf('#/login') === 0 && authed) { return this.go('#/dashboard'); }

    // Determina√ß√£o da view (ordem importa - mais espec√≠fico primeiro)
    var view = 'login';
    if (route.indexOf('#/dashboard') === 0) view = 'dashboard';
    else if (route.indexOf('#/atividades') === 0) view = 'atividades';
    if (route.indexOf('#/new')  === 0) view = 'new';
    if (route.indexOf('#/edit') === 0) view = 'new';
    if (route.indexOf('#/member?') === 0) view = 'member'; // ‚Üê MEMBRO INDIVIDUAL (deve vir antes de members!)
    if (route.indexOf('#/members') === 0) view = 'members'; // ‚Üê LISTA DE MEMBROS
    if (route.indexOf('#/practices') === 0) view = 'practices';
    if (route.indexOf('#/reports') === 0) view = 'reports';

    console.log('‚úÖ View determinada:', view);
    console.log('üîç DEBUG: Montando view:', view, 'para rota:', route);
    this.mount(view);
  },

  go: function(hash){ 
    console.log('üöÄ Router.go chamado para:', hash);
    location.hash = hash; 
  }
};
</script>