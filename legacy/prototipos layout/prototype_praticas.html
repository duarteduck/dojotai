<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro Di√°rio de Pr√°ticas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background-color: #f9fafb;
            color: #1f2937;
            line-height: 1.6;
        }

        .container {
            max-width: 1536px;
            margin: 0 auto;
            padding: 1.5rem;
            min-height: 100vh;
        }

        .card {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(to right, #2563eb, #4f46e5);
            color: white;
            padding: 1.5rem;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: #dbeafe;
        }

        .controls {
            background: #f9fafb;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .controls h2 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .days-grid {
            padding: 1rem;
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .day-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            width: 100%;
        }

        .day-card.today {
            border: 1px solid #2563eb;
            box-shadow: 0 0 0 1px #dbeafe;
        }

        .day-header {
            padding: 0.75rem;
            text-align: center;
            background: #f9fafb;
        }

        .day-header.today {
            background: #dbeafe;
        }

        .day-name {
            font-weight: 600;
            color: #1f2937;
            text-transform: capitalize;
        }

        .day-date {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .day-progress {
            margin-top: 0.25rem;
        }

        .progress-badge {
            display: inline-block;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
        }

        .progress-complete {
            background: #dcfce7;
            color: #166534;
        }

        .progress-partial {
            background: #fef3c7;
            color: #92400e;
        }

        .progress-empty {
            background: #fee2e2;
            color: #dc2626;
        }

        .practices-list {
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .practice-item {
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid;
        }

        .practice-okiyome-pessoas {
            background: #dbeafe;
            border-color: #93c5fd;
        }

        .practice-okiyome-outros {
            background: #f3e8ff;
            border-color: #c4b5fd;
        }

        .practice-receber {
            background: #dcfce7;
            border-color: #86efac;
        }

        .practice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .practice-title {
            font-weight: 500;
            font-size: 0.875rem;
            line-height: 1.2;
        }

        .practice-title.pessoas {
            color: #1e40af;
        }

        .practice-title.outros {
            color: #7c3aed;
        }

        .practice-title.receber {
            color: #166534;
        }

        .practice-explanation {
            font-size: 0.75rem;
            margin-top: 0.125rem;
        }

        .practice-explanation.pessoas {
            color: #2563eb;
        }

        .practice-explanation.outros {
            color: #8b5cf6;
        }

        .practice-explanation.receber {
            color: #16a34a;
        }

        .practice-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: 1rem;
            flex-shrink: 0;
        }

        .practice-input {
            width: 2.5rem;
            height: 2rem;
            font-size: 0.875rem;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            text-align: center;
            padding: 0.25rem;
        }

        .practice-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 1px #2563eb;
        }

        .radio-item input[type="radio"]:focus {
            outline: 1px solid #2563eb;
            outline-offset: 1px;
        }

        .practice-unit {
            font-size: 0.75rem;
            color: #6b7280;
            min-width: 50px;
        }

        .btn-increment {
            width: 2rem;
            height: 2rem;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .btn-increment:hover {
            background: #1d4ed8;
        }

        .radio-group {
            display: flex;
            gap: 0.75rem;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            cursor: pointer;
        }

        .radio-item input[type="radio"] {
            margin: 0;
        }

        .radio-item.sim {
            color: #166534;
        }

        .radio-item.nao {
            color: #dc2626;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            z-index: 50;
        }

        .modal {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            max-width: 32rem;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .btn-close {
            padding: 0.25rem;
            background: none;
            border: none;
            cursor: pointer;
            border-radius: 0.25rem;
        }

        .btn-close:hover {
            background: #f3f4f6;
        }

        .filter-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 0.75rem;
            background: #f9fafb;
            border-radius: 0.5rem;
        }

        .filter-buttons .btn {
            flex: 1;
            justify-content: center;
        }

        .btn-today {
            background: #2563eb;
            color: white;
        }

        .btn-today:hover {
            background: #1d4ed8;
        }

        .btn-month {
            background: #16a34a;
            color: white;
        }

        .btn-month:hover {
            background: #15803d;
        }

        /* Modal melhorado */
        .modal {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            max-width: 32rem;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            background: #f5f5f5;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
        }

        .calendar-nav button {
            padding: 0.5rem 0.75rem;
            background: none;
            border: none;
            cursor: pointer;
            border-radius: 0.375rem;
            min-width: 2.5rem;
            min-height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            transition: all 0.2s ease;
        }

        .calendar-nav button:hover {
            background: rgba(0,0,0,0.1);
            transform: scale(1.1);
        }

        .calendar-month-year {
            font-weight: 700;
            font-size: 1rem;
            color: #1f2937;
            text-transform: capitalize;
            min-width: 200px;
            text-align: center;
        }

        .calendar-grid {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
        }

        .calendar-weekday {
            text-align: center;
            font-size: 0.75rem;
            font-weight: 700;
            color: #6b7280;
            padding: 0.75rem 0.25rem;
            border-right: 1px solid #e5e7eb;
        }

        .calendar-weekday:last-child {
            border-right: none;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-day {
            aspect-ratio: 1;
            padding: 0;
            font-size: 0.875rem;
            border: none;
            border-right: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            min-height: 3rem;
            font-weight: 500;
            position: relative;
        }

        .calendar-day:nth-child(7n) {
            border-right: none;
        }

        .calendar-day:nth-last-child(-n+7) {
            border-bottom: none;
        }

        .calendar-day:disabled {
            color: #d1d5db;
            cursor: not-allowed;
            background: #fafafa;
        }

        .calendar-day:not(:disabled):hover {
            transform: scale(1.05);
            z-index: 1;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .calendar-day.today {
            font-weight: 700;
            position: relative;
        }

        .calendar-day.today::after {
            content: '';
            position: absolute;
            inset: 1px;
            border: 2px solid #2563eb;
            border-radius: 0.375rem;
            pointer-events: none;
        }

        /* Dia atual com status de pr√°ticas */
        .calendar-day.today.complete {
            background: #dcfce7;
            color: #166534;
        }

        .calendar-day.today.partial {
            background: #fef3c7;
            color: #92400e;
        }

        .calendar-day.today.empty {
            background: #fee2e2;
            color: #dc2626;
        }

        .calendar-day.complete {
            background: #dcfce7;
            color: #166534;
        }

        .calendar-day.partial {
            background: #fef3c7;
            color: #92400e;
        }

        .calendar-day.empty {
            background: #fee2e2;
            color: #dc2626;
        }

        .calendar-day.selected {
            font-weight: 700;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 2;
        }

        .calendar-day.selected.complete {
            background: #16a34a;
            color: white;
        }

        .calendar-day.selected.partial {
            background: #eab308;
            color: white;
        }

        .calendar-day.selected.empty {
            background: #dc2626;
            color: white;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            font-size: 0.75rem;
            margin-bottom: 1rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .legend-color {
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 0.125rem;
        }

        .legend-complete { background: #dcfce7; }
        .legend-partial { background: #fef3c7; }
        .legend-empty { background: #fee2e2; }
        .legend-selected-complete { background: #16a34a; }
        .legend-selected-partial { background: #eab308; }
        .legend-selected-empty { background: #dc2626; }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-clear {
            background: none;
            color: #6b7280;
            border: 1px solid #d1d5db;
        }

        .btn-clear:hover {
            background: #f3f4f6;
        }

        .hidden {
            display: none;
        }

        /* Responsividade melhorada */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .days-grid {
                grid-template-columns: 1fr;
                padding: 1rem;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
            }

            .controls h2 {
                text-align: center;
            }

            .btn {
                justify-content: center;
            }

            .practice-controls {
                margin-left: 0.5rem;
            }

            .calendar-day {
                min-height: 3rem;
                font-size: 0.875rem;
            }

            .calendar-weekday {
                min-height: 2.5rem;
                font-size: 0.8125rem;
            }
        }

        @media (max-width: 480px) {
            .modal {
                margin: 0.5rem;
                max-width: calc(100vw - 1rem);
            }

            .filter-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }

            .legend {
                justify-content: center;
            }

            .modal-footer {
                flex-direction: column;
                gap: 0.5rem;
            }

            .modal-footer .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <!-- Header -->
            <div class="header">
                <h1>Registro Di√°rio de Pr√°ticas</h1>
                <p>Acompanhe suas pr√°ticas dia a dia</p>
            </div>

            <!-- Controles -->
            <div class="controls">
                <h2 id="days-count">7 dias selecionados</h2>
                <button class="btn btn-primary" onclick="openCalendar()">
                    <span>üìÖ</span>
                    <span>Filtrar Dias</span>
                </button>
            </div>

            <!-- Grid de Dias -->
            <div class="days-grid" id="days-grid">
                <!-- Dias ser√£o inseridos aqui via JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal do Calend√°rio -->
    <div id="calendar-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Filtrar Dias</h3>
                <button class="btn-close" onclick="closeCalendar()">‚úï</button>
            </div>

            <div class="filter-buttons">
                <button class="btn btn-today" onclick="selectLast7Days()">
                    Hoje + 6 dias
                </button>
                <button class="btn btn-month" onclick="selectCurrentMonth()">
                    M√™s Atual
                </button>
            </div>

            <div class="calendar-nav">
                <button onclick="previousMonth()">‚Äπ</button>
                <div class="calendar-month-year" id="calendar-month-year"></div>
                <button onclick="nextMonth()">‚Ä∫</button>
            </div>

            <div class="calendar-grid">
                <div class="calendar-weekdays">
                    <div class="calendar-weekday">D</div>
                    <div class="calendar-weekday">S</div>
                    <div class="calendar-weekday">T</div>
                    <div class="calendar-weekday">Q</div>
                    <div class="calendar-weekday">Q</div>
                    <div class="calendar-weekday">S</div>
                    <div class="calendar-weekday">S</div>
                </div>
                <div class="calendar-days" id="calendar-days">
                    <!-- Dias do calend√°rio ser√£o inseridos aqui -->
                </div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color legend-complete"></div>
                    <span>Completo</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-partial"></div>
                    <span>Parcial</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-empty"></div>
                    <span>Vazio</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-selected-complete"></div>
                    <span>Selecionado (completo)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-selected-partial"></div>
                    <span>Selecionado (parcial)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-selected-empty"></div>
                    <span>Selecionado (vazio)</span>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-clear" onclick="clearSelection()">
                    Limpar
                </button>
                <button class="btn btn-secondary" onclick="closeCalendar()">
                    Fechar
                </button>
                <button class="btn btn-primary" onclick="applySelection()">
                    <span>Aplicar</span>
                    <span id="selection-count">(0)</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Dados das pr√°ticas
        const fixedPractices = [
            { 
                id: 1, 
                name: "Okiyome para Pessoas", 
                unit: "pessoas", 
                defaultValue: 1,
                explanation: "Contar cada 1 pessoa",
                type: "counter",
                class: "pessoas"
            },
            { 
                id: 2, 
                name: "Outros Okiyome", 
                unit: "okiyome", 
                defaultValue: 1,
                explanation: "Autoaplica√ß√£o, no ambiente, qualquer coisa que n√£o seja outra pessoa",
                type: "counter",
                class: "outros"
            },
            { 
                id: 3, 
                name: "Receber Okiyome", 
                unit: "",
                defaultValue: 1,
                explanation: "Quando receber okiyome de outra pessoa",
                type: "yesno",
                class: "receber"
            }
        ];

        // Estado global
        let selectedDays = [];
        let practices = {};
        let currentMonth = new Date();

        // Inicializar aplica√ß√£o
        function init() {
            selectLast7Days();
            renderDays();
        }

        // Obter √∫ltimos 7 dias
        function getLast7Days() {
            const days = [];
            const today = new Date();
            for (let i = 6; i >= 0; i--) {
                const day = new Date(today);
                day.setDate(today.getDate() - i);
                days.push(day);
            }
            return days;
        }

        // Obter dias do m√™s atual
        function getCurrentMonthDays() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            const days = [];
            for (let day = new Date(firstDay); day <= lastDay; day.setDate(day.getDate() + 1)) {
                days.push(new Date(day));
            }
            return days;
        }

        // Selecionar √∫ltimos 7 dias
        function selectLast7Days() {
            selectedDays = getLast7Days();
            initializePractices();
            renderDays();
            updateDaysCount();
        }

        // Selecionar m√™s atual
        function selectCurrentMonth() {
            selectedDays = getCurrentMonthDays();
            initializePractices();
            renderDays();
            updateDaysCount();
        }

        // Inicializar pr√°ticas para os dias
        function initializePractices() {
            selectedDays.forEach(day => {
                const dateKey = day.toISOString().split('T')[0];
                if (!practices[dateKey]) {
                    practices[dateKey] = {};
                    fixedPractices.forEach(practice => {
                        if (practice.type === 'yesno') {
                            practices[dateKey][practice.id] = { completed: false, value: null };
                        } else {
                            practices[dateKey][practice.id] = { completed: false, quantity: 0 };
                        }
                    });
                }
            });
        }

        // Obter progresso do dia
        function getDayProgress(dateKey) {
            const dayPractices = practices[dateKey];
            if (!dayPractices) return { completed: 0, total: fixedPractices.length, percentage: 0 };
            
            let completed = 0;
            const total = fixedPractices.length;
            
            fixedPractices.forEach(practice => {
                const practiceData = dayPractices[practice.id];
                if (practice.type === 'yesno') {
                    if (practiceData?.completed && practiceData.value !== null) completed++;
                } else if (practiceData?.completed && practiceData.quantity > 0) {
                    completed++;
                }
            });
            
            return { completed, total, percentage: Math.round((completed / total) * 100) };
        }

        // Verificar status das pr√°ticas do dia
        function getDayPracticesStatus(date) {
            const dateKey = date.toISOString().split('T')[0];
            const progress = getDayProgress(dateKey);
            
            return {
                hasAny: progress.completed > 0,
                isComplete: progress.percentage === 100,
                isPartial: progress.completed > 0 && progress.completed < progress.total
            };
        }

        // Renderizar dias
        function renderDays() {
            const grid = document.getElementById('days-grid');
            const sortedDays = [...selectedDays].sort((a, b) => b - a); // Mais recentes primeiro
            
            grid.innerHTML = sortedDays.map(day => {
                const dateKey = day.toISOString().split('T')[0];
                const progress = getDayProgress(dateKey);
                const isToday = day.toDateString() === new Date().toDateString();
                
                return `
                    <div class="day-card ${isToday ? 'today' : ''}">
                        <div class="day-header ${isToday ? 'today' : ''}">
                            <div class="day-name">${day.toLocaleDateString('pt-BR', { weekday: 'long' })}</div>
                            <div class="day-date">${day.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' })}</div>
                            <div class="day-progress">
                                <div class="progress-badge ${getProgressClass(progress.percentage)}">
                                    Registros: ${progress.completed}/${progress.total}
                                </div>
                            </div>
                        </div>
                        <div class="practices-list">
                            ${fixedPractices.map(practice => renderPractice(practice, dateKey)).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Obter classe CSS do progresso
        function getProgressClass(percentage) {
            if (percentage === 100) return 'progress-complete';
            if (percentage > 0) return 'progress-partial';
            return 'progress-empty';
        }

        // Renderizar pr√°tica
        function renderPractice(practice, dateKey) {
            const practiceData = practices[dateKey]?.[practice.id] || 
                (practice.type === 'yesno' ? { completed: false, value: null } : { completed: false, quantity: 0 });

            if (practice.type === 'yesno') {
                return `
                    <div class="practice-item practice-${practice.class}">
                        <div class="practice-header">
                            <div>
                                <div class="practice-title ${practice.class}">${practice.name}</div>
                                <div class="practice-explanation ${practice.class}">${practice.explanation}</div>
                            </div>
                            <div class="practice-controls">
                                <div class="radio-group">
                                    <label class="radio-item sim">
                                        <input type="radio" name="${practice.class}-${dateKey}" 
                                               ${practiceData.value === true ? 'checked' : ''}
                                               onchange="setYesNoValue('${dateKey}', ${practice.id}, true)">
                                        <span>Sim</span>
                                    </label>
                                    <label class="radio-item nao">
                                        <input type="radio" name="${practice.class}-${dateKey}" 
                                               ${practiceData.value === false ? 'checked' : ''}
                                               onchange="setYesNoValue('${dateKey}', ${practice.id}, false)">
                                        <span>N√£o</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                return `
                    <div class="practice-item practice-okiyome-${practice.class}">
                        <div class="practice-header">
                            <div>
                                <div class="practice-title ${practice.class}">${practice.name}</div>
                                <div class="practice-explanation ${practice.class}">${practice.explanation}</div>
                            </div>
                            <div class="practice-controls">
                                <input type="number" min="0" 
                                       class="practice-input"
                                       value="${practiceData.quantity || 0}"
                                       onchange="updateQuantity('${dateKey}', ${practice.id}, this.value)">
                                <span class="practice-unit">${practice.unit}</span>
                                <button class="btn-increment" onclick="incrementPractice('${dateKey}', ${practice.id})">
                                    +
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Definir valor sim/n√£o
        function setYesNoValue(dateKey, practiceId, value) {
            if (!practices[dateKey]) practices[dateKey] = {};
            practices[dateKey][practiceId] = {
                completed: true,
                value: value
            };
            renderDays();
        }

        // Incrementar pr√°tica
        function incrementPractice(dateKey, practiceId) {
            if (!practices[dateKey]) practices[dateKey] = {};
            const current = practices[dateKey][practiceId]?.quantity || 0;
            practices[dateKey][practiceId] = {
                completed: true,
                quantity: current + 1
            };
            renderDays();
        }

        // Atualizar quantidade
        function updateQuantity(dateKey, practiceId, newValue) {
            if (!practices[dateKey]) practices[dateKey] = {};
            const quantity = Math.max(0, parseInt(newValue) || 0);
            practices[dateKey][practiceId] = {
                completed: quantity > 0,
                quantity: quantity
            };
            renderDays();
        }

        // Atualizar contador de dias
        function updateDaysCount() {
            document.getElementById('days-count').textContent = `${selectedDays.length} dias selecionados`;
        }

        // Abrir calend√°rio
        function openCalendar() {
            document.getElementById('calendar-modal').classList.remove('hidden');
            renderCalendar();
        }

        // Fechar calend√°rio
        function closeCalendar() {
            document.getElementById('calendar-modal').classList.add('hidden');
        }

        // M√™s anterior
        function previousMonth() {
            currentMonth.setMonth(currentMonth.getMonth() - 1);
            renderCalendar();
        }

        // Pr√≥ximo m√™s
        function nextMonth() {
            currentMonth.setMonth(currentMonth.getMonth() + 1);
            renderCalendar();
        }

        // Renderizar calend√°rio
        function renderCalendar() {
            // Atualizar t√≠tulo do m√™s
            document.getElementById('calendar-month-year').textContent = 
                currentMonth.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });

            // Gerar dias do calend√°rio
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            const firstDay = new Date(year, month, 1);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const calendarDays = [];
            const current = new Date(startDate);
            
            for (let i = 0; i < 42; i++) {
                const isCurrentMonth = current.getMonth() === month;
                const dateKey = current.toISOString().split('T')[0];
                const isSelected = selectedDays.some(d => d.toISOString().split('T')[0] === dateKey);
                const practicesStatus = getDayPracticesStatus(current);
                const isToday = current.toDateString() === new Date().toDateString();
                
                let dayClass = 'calendar-day';
                
                if (!isCurrentMonth) {
                    dayClass += ' disabled';
                } else {
                    // Primeiro aplicar o status das pr√°ticas
                    if (practicesStatus.isComplete) {
                        dayClass += ' complete';
                    } else if (practicesStatus.isPartial) {
                        dayClass += ' partial';
                    } else {
                        dayClass += ' empty';
                    }
                    
                    // Depois aplicar today (que vai manter as cores de status)
                    if (isToday) {
                        dayClass += ' today';
                    }
                    
                    // Por √∫ltimo aplicar selected
                    if (isSelected) {
                        dayClass += ' selected';
                    }
                }
                
                calendarDays.push(`
                    <button class="${dayClass}" 
                            ${!isCurrentMonth ? 'disabled' : ''}
                            onclick="${isCurrentMonth ? `toggleDaySelection('${dateKey}')` : ''}">
                        ${current.getDate()}
                    </button>
                `);
                
                current.setDate(current.getDate() + 1);
            }
            
            document.getElementById('calendar-days').innerHTML = calendarDays.join('');
            updateSelectionCount();
        }

        // Alternar sele√ß√£o de dia
        function toggleDaySelection(dateKey) {
            const date = new Date(dateKey + 'T00:00:00');
            const isSelected = selectedDays.some(d => d.toISOString().split('T')[0] === dateKey);
            
            if (isSelected) {
                selectedDays = selectedDays.filter(d => d.toISOString().split('T')[0] !== dateKey);
            } else {
                selectedDays.push(date);
            }
            
            renderCalendar();
            updateSelectionCount();
        }

        // Atualizar contador de sele√ß√£o
        function updateSelectionCount() {
            document.getElementById('selection-count').textContent = `(${selectedDays.length})`;
        }

        // Limpar sele√ß√£o
        function clearSelection() {
            selectedDays = [];
            renderCalendar();
            updateSelectionCount();
        }

        // Aplicar sele√ß√£o
        function applySelection() {
            initializePractices();
            renderDays();
            updateDaysCount();
            closeCalendar();
        }

        // Inicializar aplica√ß√£o quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>